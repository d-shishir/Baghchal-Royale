@startuml
' skinparam to improve the look and feel
skinparam sequence {
    ParticipantBackgroundColor White
    ActorBorderColor Black
    ActorBackgroundColor White
    ArrowColor Black
    BorderColor Black
}
skinparam shadowing false
skinparam monochrome true

title Sequence Diagram: Friendship Request Flow

actor "User A" as UA
participant "Frontend A" as FEA
participant "Backend API" as BE
database "Database" as DB
participant "Frontend B" as FEB
actor "User B" as UB

== Send Friend Request ==
UA -> FEA: Search for User B
FEA -> BE: GET /api/v1/users/search?query=userB
BE -> DB: Query users
DB --> BE: Return search results
BE --> FEA: User B found
FEA -> UA: Display User B

UA -> FEA: Click "Add Friend"
FEA -> BE: POST /api/v1/friends/request
activate BE
BE -> BE: Authenticate User A
BE -> DB: Check if friendship already exists
alt friendship exists
    BE --> FEA: 400 Bad Request (already friends/pending)
else no existing friendship
    BE -> DB: Create new friendship record (status: pending)
    activate DB
    DB --> BE: Friendship created
    deactivate DB
    BE --> FEA: 200 OK (request sent)
end
deactivate BE
FEA -> UA: Show "Friend request sent"

== Accept Friend Request ==
UB -> FEB: Navigate to Friends tab
FEB -> BE: GET /api/v1/friends/requests
BE -> DB: Get pending requests for User B
DB --> BE: Return pending requests
BE --> FEB: List of pending requests
FEB -> UB: Show pending requests

UB -> FEB: Click "Accept" for User A
FEB -> BE: PUT /api/v1/friends/request/{id}
activate BE
BE -> BE: Authenticate User B
BE -> DB: Update friendship status to "accepted"
activate DB
DB --> BE: Status updated
deactivate DB
BE --> FEB: 200 OK (request accepted)
deactivate BE
FEB -> UB: Show "Friend request accepted"

@enduml 